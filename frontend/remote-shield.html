<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remote Shield - Citadel Archer</title>

    <!-- PRD: Remote Shield page - VPS agent monitoring, threat heatmap, timeline -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'neon-blue': '#00D9FF',
                        'dark-bg': '#0A0E27',
                        'card-bg': 'rgba(15, 23, 42, 0.6)',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="css/styles.css">

    <style>
        /* ── Stats bar ───────────────────────────────────────────── */
        .rs-stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
        }

        .rs-stat-card {
            background: var(--card-bg, rgba(15, 23, 42, 0.6));
            border: 1px solid rgba(0, 217, 255, 0.15);
            border-radius: 10px;
            padding: 0.75rem;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .rs-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #00D9FF;
        }

        .rs-stat-label {
            font-size: 0.7rem;
            color: #9CA3AF;
            margin-top: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        /* ── Agent panels ────────────────────────────────────────── */
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 0.75rem;
        }

        .agent-panel {
            background: var(--card-bg, rgba(15, 23, 42, 0.6));
            border: 1px solid rgba(0, 217, 255, 0.15);
            border-radius: 10px;
            padding: 0.875rem;
            backdrop-filter: blur(10px);
            transition: border-color 0.2s ease;
        }

        .agent-panel:hover {
            border-color: rgba(0, 217, 255, 0.35);
        }

        .agent-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.625rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .agent-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .agent-status-indicator.active {
            background: #00cc66;
            box-shadow: 0 0 6px #00cc66;
            animation: pulse 2s infinite;
        }

        .agent-status-indicator.inactive {
            background: #ff3333;
            box-shadow: 0 0 6px #ff3333;
            animation: none;
        }

        .agent-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: #E5E7EB;
        }

        .agent-info {
            display: grid;
            gap: 0.375rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
        }

        .info-label {
            color: #6B7280;
            font-weight: 500;
        }

        .info-value {
            color: #D1D5DB;
            font-family: 'Courier New', monospace;
            font-size: 0.7rem;
        }

        /* ── Patch status cards ─────────────────────────────────── */
        .patch-card {
            background: var(--card-bg, rgba(15, 23, 42, 0.6));
            border: 1px solid rgba(0, 217, 255, 0.15);
            border-radius: 10px;
            padding: 0.875rem;
            backdrop-filter: blur(10px);
            transition: border-color 0.2s ease;
        }

        .patch-card:hover {
            border-color: rgba(0, 217, 255, 0.35);
        }

        .patch-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .patch-dot.ok { background: #00cc66; box-shadow: 0 0 6px #00cc66; }
        .patch-dot.warning { background: #e6b800; box-shadow: 0 0 6px #e6b800; }
        .patch-dot.critical { background: #ff3333; box-shadow: 0 0 6px #ff3333; }
        .patch-dot.unknown { background: #6B7280; box-shadow: 0 0 4px #6B7280; }

        .patch-status-badge {
            margin-left: auto;
            font-size: 0.6rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
        }

        .patch-status-badge.ok { background: rgba(0, 204, 102, 0.15); color: #00cc66; }
        .patch-status-badge.warning { background: rgba(230, 184, 0, 0.15); color: #e6b800; }
        .patch-status-badge.critical { background: rgba(255, 51, 51, 0.15); color: #ff3333; }
        .patch-status-badge.unknown { background: rgba(107, 114, 128, 0.15); color: #6B7280; }

        .patch-check-btn {
            width: 100%;
            margin-top: 0.625rem;
            padding: 0.4rem 0;
            background: rgba(0, 217, 255, 0.1);
            color: #00D9FF;
            border: 1px solid rgba(0, 217, 255, 0.25);
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease, border-color 0.2s ease;
        }

        .patch-check-btn:hover {
            background: rgba(0, 217, 255, 0.2);
            border-color: rgba(0, 217, 255, 0.5);
        }

        .patch-check-btn:disabled {
            opacity: 0.5;
            cursor: default;
        }

        /* ── Group policies ─────────────────────────────────────── */
        .policy-section {
            background: var(--card-bg, rgba(15, 23, 42, 0.6));
            border: 1px solid rgba(0, 217, 255, 0.15);
            border-radius: 10px;
            padding: 0.875rem;
            backdrop-filter: blur(10px);
            margin-bottom: 1rem;
        }
        .policy-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 0.75rem; font-size: 0.8rem; font-weight: 600; color: #e2e8f0;
        }
        .policy-card {
            background: rgba(15, 23, 42, 0.4);
            border: 1px solid rgba(0, 217, 255, 0.1);
            border-radius: 8px; padding: 0.75rem; margin-bottom: 0.5rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .policy-card-info { flex: 1; }
        .policy-card-name { font-size: 0.8rem; font-weight: 600; color: #e2e8f0; }
        .policy-card-meta { font-size: 0.7rem; color: #94a3b8; margin-top: 2px; }
        .policy-card-actions { display: flex; gap: 0.4rem; }
        .compliance-badge {
            font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; font-weight: 600;
        }
        .compliance-badge.ok { background: rgba(0, 204, 102, 0.15); color: #00cc66; }
        .compliance-badge.partial { background: rgba(230, 184, 0, 0.15); color: #e6b800; }
        .compliance-badge.none { background: rgba(107, 114, 128, 0.15); color: #6B7280; }

        /* ── Threat timeline ─────────────────────────────────────── */
        .threat-timeline {
            background: var(--card-bg, rgba(15, 23, 42, 0.6));
            border: 1px solid rgba(0, 217, 255, 0.15);
            border-radius: 10px;
            padding: 0.875rem;
            max-height: 400px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .timeline-header {
            font-size: 0.8rem;
            font-weight: 600;
            color: #E5E7EB;
            margin-bottom: 0.625rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .threat-count {
            background: rgba(0, 217, 255, 0.15);
            color: #00D9FF;
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.65rem;
            font-weight: 600;
        }

        .threat-item {
            background: rgba(255, 255, 255, 0.03);
            border-left: 2px solid;
            padding: 0.5rem 0.625rem;
            margin-bottom: 0.375rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }

        .threat-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .threat-item.severity-critical { border-left-color: #ff3333; }
        .threat-item.severity-high { border-left-color: #ff9900; }
        .threat-item.severity-medium { border-left-color: #e6b800; }
        .threat-item.severity-low { border-left-color: #00cc66; }

        .threat-title {
            font-weight: 600;
            font-size: 0.75rem;
            color: #E5E7EB;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .threat-badge {
            display: inline-block;
            padding: 0.1rem 0.375rem;
            border-radius: 4px;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .threat-badge.critical { background: rgba(255, 51, 51, 0.2); color: #ff3333; }
        .threat-badge.high { background: rgba(255, 153, 0, 0.2); color: #ff9900; }
        .threat-badge.medium { background: rgba(230, 184, 0, 0.2); color: #e6b800; }
        .threat-badge.low { background: rgba(0, 204, 102, 0.2); color: #00cc66; }

        .threat-meta {
            display: flex;
            gap: 0.75rem;
            font-size: 0.65rem;
            color: #6B7280;
        }

        .threat-meta-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* ── Heatmap ─────────────────────────────────────────────── */
        .vps-heatmap {
            background: var(--card-bg, rgba(15, 23, 42, 0.6));
            border: 1px solid rgba(0, 217, 255, 0.15);
            border-radius: 10px;
            padding: 0.875rem;
            backdrop-filter: blur(10px);
        }

        .heatmap-header {
            font-size: 0.8rem;
            font-weight: 600;
            color: #E5E7EB;
            margin-bottom: 0.625rem;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.5rem;
        }

        .heatmap-cell {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(0, 217, 255, 0.1);
            border-radius: 8px;
            padding: 0.625rem;
            text-align: center;
            transition: border-color 0.2s ease;
            cursor: pointer;
        }

        .heatmap-cell:hover {
            border-color: rgba(0, 217, 255, 0.3);
        }

        .heatmap-hostname {
            font-weight: 600;
            color: #D1D5DB;
            font-size: 0.7rem;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .heatmap-count {
            font-size: 1.25rem;
            font-weight: 700;
            color: #00D9FF;
            margin: 0.25rem 0;
        }

        .heatmap-level {
            display: inline-block;
            font-size: 0.6rem;
            font-weight: 600;
            padding: 0.1rem 0.375rem;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .heatmap-level.critical { background: rgba(255, 51, 51, 0.2); color: #ff3333; }
        .heatmap-level.high { background: rgba(255, 153, 0, 0.2); color: #ff9900; }
        .heatmap-level.medium { background: rgba(230, 184, 0, 0.2); color: #e6b800; }
        .heatmap-level.none { background: rgba(0, 204, 102, 0.2); color: #00cc66; }

        /* ── Empty state ─────────────────────────────────────────── */
        .empty-state {
            text-align: center;
            padding: 1.5rem;
            color: #6B7280;
            font-size: 0.75rem;
        }

        .empty-state-icon {
            margin-bottom: 0.5rem;
            opacity: 0.5;
        }

        /* ── Live badge ──────────────────────────────────────────── */
        .rs-live-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.2rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            background: rgba(0, 204, 102, 0.12);
            color: #00cc66;
            border: 1px solid rgba(0, 204, 102, 0.25);
        }

        .rs-live-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #00cc66;
            animation: pulse 2s infinite;
        }

        /* ── Responsive ──────────────────────────────────────────── */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @media (max-width: 768px) {
            .rs-stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            .agents-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="dark bg-dark-bg text-gray-100 font-sans antialiased">
    <script>if (window !== window.top) document.body.classList.add('in-iframe');</script>

    <!-- Main App Container -->
    <div id="app" class="min-h-screen">

        <!-- Header (matches index.html) -->
        <header class="glass-card border-b border-neon-blue/20 px-4 py-2">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 rounded-lg bg-neon-blue/20 flex items-center justify-center">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#00D9FF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-neon-blue">Citadel Archer</h1>
                        <p class="text-xs text-gray-400">v0.2.4 - Proactive Protection</p>
                    </div>
                </div>

                <div class="flex items-center space-x-3">
                    <a href="index.html" class="px-3 py-1.5 rounded-lg bg-neon-blue/10 hover:bg-neon-blue/20 border border-neon-blue/30 transition-colors flex items-center space-x-1.5 text-sm">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                        <span>Dashboard</span>
                    </a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-3">

            <!-- Page Title & Controls -->
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-3">
                <div>
                    <h2 class="text-lg font-bold flex items-center gap-2">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#00D9FF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        Remote Shield
                    </h2>
                    <p class="text-xs text-gray-400 mt-0.5">VPS agent monitoring &amp; threat intelligence</p>
                </div>

                <div class="flex items-center space-x-3">
                    <div class="rs-live-badge">
                        <span class="rs-live-dot"></span>
                        <span>Monitoring</span>
                    </div>
                </div>
            </div>

            <!-- ── Technical View (visible by default) ── -->
            <div id="rs-technical-view">

            <!-- Stats Bar -->
            <div class="rs-stats-bar mb-4">
                <div class="rs-stat-card">
                    <div class="rs-stat-value" id="total-agents">0</div>
                    <div class="rs-stat-label">Connected</div>
                </div>
                <div class="rs-stat-card">
                    <div class="rs-stat-value" id="active-agents">0</div>
                    <div class="rs-stat-label">Active</div>
                </div>
                <div class="rs-stat-card">
                    <div class="rs-stat-value" style="color: #ff9900;" id="total-threats">0</div>
                    <div class="rs-stat-label">Threats</div>
                </div>
                <div class="rs-stat-card">
                    <div class="rs-stat-value" style="color: #ff3333;" id="critical-threats">0</div>
                    <div class="rs-stat-label">Critical</div>
                </div>
            </div>

            <!-- Two-column: Agents + Heatmap -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 mb-3">

                <!-- Agent List -->
                <div>
                    <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 flex items-center gap-1.5">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg>
                        VPS Agents
                    </div>
                    <div class="agents-grid" id="agents-container">
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block;opacity:0.4"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg>
                            </div>
                            <div>No agents connected</div>
                        </div>
                    </div>
                </div>

                <!-- VPS Heatmap -->
                <div class="vps-heatmap">
                    <div class="heatmap-header">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#00D9FF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
                        Threat Heatmap
                    </div>
                    <div class="heatmap-grid" id="heatmap-grid">
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block;opacity:0.4"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                            </div>
                            <div>No agents registered yet</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Patch Status (Windows Update Monitoring) -->
            <div style="margin-bottom: 0.75rem;">
                <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 flex items-center gap-1.5">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                    Windows Update Status
                </div>
                <div class="agents-grid" id="patch-status-container">
                    <div class="empty-state">
                        <div>Waiting for update data...</div>
                    </div>
                </div>
            </div>

            <!-- Group Policies -->
            <div class="policy-section">
                <div class="policy-header">
                    <span class="flex items-center gap-1.5">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#00D9FF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        Group Policies
                    </span>
                    <button class="patch-check-btn" id="add-policy-btn" title="Create new policy group">+ Add Group</button>
                </div>
                <div id="policy-groups-container">
                    <div class="empty-state" style="font-size:0.75rem;color:#6B7280;padding:0.5rem 0;">
                        No policy groups defined yet
                    </div>
                </div>
            </div>

            <!-- Threat Timeline (full-width) -->
            <div class="threat-timeline">
                <div class="timeline-header">
                    <span class="flex items-center gap-1.5">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#ff9900" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                        Threat Timeline
                    </span>
                    <span class="threat-count" id="threat-filter-active">All</span>
                </div>
                <div id="threat-timeline-container">
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block;opacity:0.4"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                        </div>
                        <div>No threats detected</div>
                    </div>
                </div>
            </div>

            </div><!-- /rs-technical-view -->

            <!-- ── Simplified View (hidden by default, shown in simplified mode) ── -->
            <div id="rs-simplified-view" style="display: none;">
                <!-- Hero status -->
                <div id="rs-simplified-hero" style="text-align: center; padding: 2rem 1rem; margin-bottom: 1.25rem; background: var(--card-bg, rgba(15, 23, 42, 0.6)); border: 1px solid rgba(0, 217, 255, 0.15); border-radius: 12px; backdrop-filter: blur(10px);">
                    <div id="rs-hero-icon" style="margin-bottom: 0.75rem;"></div>
                    <div id="rs-hero-title" style="font-size: 1.25rem; font-weight: 700; color: #E5E7EB; margin-bottom: 0.375rem;"></div>
                    <div id="rs-hero-subtitle" style="font-size: 0.8rem; color: #9CA3AF;"></div>
                </div>

                <!-- Device list -->
                <div style="margin-bottom: 1.25rem;">
                    <div style="font-size: 0.75rem; font-weight: 600; color: #9CA3AF; text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: 0.625rem;">Your Devices</div>
                    <div id="rs-device-list" style="display: grid; gap: 0.5rem;"></div>
                </div>

                <!-- Alert cards -->
                <div id="rs-alert-cards-section" style="display: none;">
                    <div style="font-size: 0.75rem; font-weight: 600; color: #ff9900; text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: 0.625rem;">Alerts That Need Your Attention</div>
                    <div id="rs-alert-cards" style="display: grid; gap: 0.5rem;"></div>
                </div>
            </div>

        </main>

        <!-- Footer -->
        <footer class="text-center py-3 text-gray-500 text-xs">
            <p>Protected by Citadel Archer AI &middot; Remote Shield &middot; VPS Defense</p>
        </footer>
    </div>

    <!-- Remote Shield JavaScript -->
    <script type="module" src="js/remote-shield.js"></script>

</body>
</html>
